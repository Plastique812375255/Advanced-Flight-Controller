# AFC用户界面设计文档

## 1. 项目概述

### 1.1 项目简介
AFC(Advanced Flight Controller)是一套开放式、可扩展的遥控器操作系统，旨在为航模爱好者提供更灵活、直观的控制体验。系统由三个核心组件构成：

- **AFCUI**：基于HTML5的用户界面客户端，提供直观的操作与配置环境
- **AFTX**：运行在遥控器上的独立程序，可脱离AFCUI单独运行
- **AFRX**：运行在接收机上的程序，负责信号接收与处理

### 1.2 运行模式
AFC系统支持两种主要运行模式：

| 特性 | AFC模式 | TRAD模式 |
|------|---------|---------|
| 数据存储位置 | AFRX | AFTX |
| 输出计算位置 | AFRX | AFTX |
| 模型选择 | 自动识别 | 手动选择 |
| 兼容性 | 专用AFRX接收机 | 外源高频头 |
| 特点 | 智能化程度高 | 类似传统遥控系统 |

### 1.3 目标用户
- 航模爱好者（初学者到专业用户）
- 无人机操作人员
- 遥控设备开发者与定制用户

## 2. AFCUI架构设计

### 2.1 技术基础
- 基于HTML5/JavaScript开发的跨平台界面
- 首期支持Android平台，预留iOS兼容性
- 采用响应式设计确保在不同设备上的一致体验

### 2.2 模块化设计架构

#### 2.2.1 通用模块
提供核心功能与标准接口：

1. **通信模块**：提供蓝牙与有线通信接口，实现与AFTX的稳定连接
2. **飞行界面系统**：提供可定制的模块化桌面，展示关键信息
3. **设置模块**：管理通用配置（输出类型、通道分配等）
4. **飞行模式模块**：支持2-16个档位，包含一个安全挡、一个预备挡和数个飞行挡。预备挡没有独立的一组参数，使用安全挡参数。
5. **扩展模块**：负责机型、插件与小组件的管理与更新

#### 2.2.2 机型模块
针对特定机型提供专属功能：

1. **设置向导**：引导用户完成初始配置（舵机正反向、中位点、行程等）
2. **飞行界面**：提供适配特定机型的操作界面
3. **映射表**：定义输出端口与控制输入的对应关系
4. **参数预设**：包含机型特定的默认设置数据

### 2.3 数据流架构

1. 用户输入 → AFCUI界面 → 数据处理 → AFTX
2. AFTX → 信号转换 → AFRX → 控制执行
3. AFRX → 遥测数据 → AFTX → AFCUI展示

## 3. 用户界面设计

### 3.1 基本规范
- 强制横屏显示，不支持竖屏模式
- 全屏设计，隐藏系统状态栏，屏蔽系统级返回按钮
- 采用16×6网格系统作为布局基础
- 主题配色：主色调、次色调、强调色（具体色值待定）

### 3.2 桌面系统

#### 3.2.1 状态栏
位于界面顶部，始终显示：
- 设备电量指示
- 无线连接状态（WiFi/蜂窝）
- 系统时间
- 当前飞行模式

#### 3.2.2 未对频桌面
- **第一页**：显示两个主按钮（TRAD模式、对频按钮）
- **第二页**：展示摇杆/开关状态监控面板

#### 3.2.3 已对频桌面
- **第一页**：自定义飞行界面（小组件布局）
- **第二页**：参数配置页，包含分类页签与参数面板。页面由机型控制，不同机型会有不同的页面。

### 3.3 组件系统

#### 3.3.1 小组件框架
- 基于16×6网格的响应式小组件布局
- 组件尺寸必须为整数网格（如1×3、3×3等）
- 支持长按进入编辑模式，拖拽定位
- 组件自动对齐网格线

#### 3.3.2 组件类型
- 系统核心组件：飞行数据、控制状态等
- 机型特定组件：针对特定飞行器的专用控制
- 用户自定义组件：可通过扩展仓库下载

#### 3.3.3 组件生命周期
1. 初始化 → 加载配置 → 渲染界面
2. 数据更新 → 界面刷新
3. 用户交互 → 事件处理 → 数据更新

### 3.4 菜单系统
- 右滑手势激活，从右侧弹出
- 宽度占屏幕50%，支持上下滚动
- 包含分类标题与功能条目
- 条目由图标+文字组成，支持层级导航

### 3.5 窗口系统
- 模态窗口居中显示，占屏幕80%宽度，70%高度
- 包含标题栏与关闭按钮
- 点击窗口外区域自动关闭
- 窗口打开时背景自动半透明遮罩

## 4. 交互流程

### 4.1 启动与连接流程
1. 应用启动 → 检查本地存储 → 加载基础界面
2. 用户选择操作模式：
   - TRAD模式：连接AFTX，读取本地模型
   - AFC模式：启动对频流程，连接AFRX

### 4.2 机型加载流程
1. 连接成功 → 读取设备信息（AFRX/AFTX）
2. 检查机型数据：
   - 已存在：加载对应界面与配置
   - 首次使用：提示选择机型
3. 检查本地机型资源：
   - 已下载：直接加载
   - 未下载：添加到下载队列，等待网络连接

### 4.3 飞行控制流程
1. 飞行界面加载 → 组件初始化
2. 用户输入 → 数据处理 → 发送至AFTX
3. 遥测数据返回 → 界面实时更新

## 5. 开发规范

### 5.1 多语言支持
- 支持语言：英语（默认）、简体中文、日语、德语
- 采用CSV格式存储语言映射表
- 每个文本项对应唯一lang_id
- 缺失翻译自动回退至英语

### 5.2 离线工作机制
- 首次启动下载核心资源包
- 本地存储机型与配置数据
- WiFi连接时自动同步更新

### 5.3 性能优化
- 界面渲染优先级管理
- 数据缓存机制
- 资源按需加载
- 低功耗模式支持

### 5.4 安全机制
- 关键操作二次确认
- 飞行数据本地备份
- 异常中断恢复机制

## 6. 附录

### 6.1 标准组件库列表
（待补充）

### 6.2 界面原型图
（待补充）

### 6.3 数据结构定义
（待补充）

---

*注：本文档将随项目发展持续更新* 