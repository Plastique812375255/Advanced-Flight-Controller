<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ¬åœ°HTMLæ¼”ç¤º</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: relative;
            -webkit-text-size-adjust: 100%; /* é˜²æ­¢iOSè®¾å¤‡ä¸Šçš„æ–‡æœ¬å¤§å°è‡ªåŠ¨è°ƒæ•´ */
        }
        
        h1 {
            margin: 0;
            padding: 0;
            font-size: 1.5rem; /* å“åº”å¼å­—ä½“å¤§å° */
            white-space: nowrap; /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
            overflow: hidden; /* é˜²æ­¢æ–‡æœ¬æº¢å‡º */
            text-overflow: ellipsis; /* æ–‡æœ¬æº¢å‡ºæ—¶æ˜¾ç¤ºçœç•¥å· */
            max-width: 100%; /* é™åˆ¶æœ€å¤§å®½åº¦ */
        }
        
        /* åœ¨å°å±å¹•ä¸Šè°ƒæ•´å­—ä½“å¤§å° */
        @media screen and (max-width: 768px) {
            h1 {
                font-size: 1.2rem;
            }
        }
        
        /* åœ¨æ›´å°çš„å±å¹•ä¸Šç»§ç»­è°ƒæ•´å­—ä½“å¤§å° */
        @media screen and (max-width: 480px) {
            h1 {
                font-size: 1rem;
            }
        }
        .frame-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡ºå¯¼è‡´æ»šåŠ¨æ¡ */
            position: fixed; /* ç¡®ä¿å®¹å™¨å›ºå®šåœ¨è§†å£å†… */
            top: 0;
            left: 0;
        }
        .top-frame {
            height: 11.11%; /* 1/9çš„é«˜åº¦ */
            min-height: 50px; /* ç¡®ä¿æœ€å°é«˜åº¦ */
            background-color: #333;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-align: center;
            padding: 10px 15px;
            box-sizing: border-box;
            position: relative;
            z-index: 10; /* ç¡®ä¿é¡¶éƒ¨æ æ€»æ˜¯å¯è§ */
            flex-shrink: 0; /* é˜²æ­¢é¡¶éƒ¨æ è¢«å‹ç¼© */
        }
        
        /* åˆ é™¤åŒºåŸŸæ ·å¼ */
        .top-frame.delete-active {
            background: linear-gradient(to bottom, rgba(255, 0, 0, 0.8), #333);
            transition: all 0.3s ease;
        }
        
        .top-frame.delete-active.drag-over {
            background: linear-gradient(to bottom, rgb(255, 0, 0), #333);
        }
        
        .delete-zone-text {
            display: none;
            color: white;
            font-weight: bold;
            font-size: 16px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            animation: pulse 2s infinite;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            text-align: center;
        }
        
        .top-frame.delete-active .delete-zone-text {
            display: block;
        }
        
        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        
        /* é€€å‡ºç¼–è¾‘æ¨¡å¼æŒ‰é’® */
        #exitEditModeBtn {
            display: none;
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background-color: #f44336;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            z-index: 100;
        }
        
        .bottom-frame {
            height: 88.89%; /* 8/9çš„é«˜åº¦ */
            overflow: hidden;
            position: relative;
            flex-grow: 1; /* å…è®¸åº•éƒ¨æ¡†æ¶è‡ªé€‚åº”å¢é•¿ */
        }
        iframe {
            border: none;
            width: 100%;
            height: 100%;
        }
        
        /* èœå•æ ·å¼ */
        #afcMenuOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10000;
            display: none;
        }
        
        #afcMenu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100vh;
            background-color: white;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            z-index: 10001;
            overflow-y: auto;
            transition: right 0.3s ease;
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }
        
        .widget-menu-title {
            font-weight: bold;
            padding: 15px;
            background-color: #f5f5f5;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .widget-menu-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #888;
        }
        
        #afcMenuList {
            padding: 10px;
        }
        
        .menu-option {
            padding: 15px;
            margin-bottom: 8px;
            cursor: pointer;
            border-radius: 6px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        
        .menu-option:hover,
        .menu-option:active {
            background-color: #e8e8e8;
            border-color: #ddd;
        }
        
        .menu-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e0e0e0;
            border-radius: 50%;
            color: #555;
            font-weight: bold;
            font-size: 14px;
        }
        
        /* ç»„ä»¶èœå•æ ·å¼ */
        .widget-option {
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            border-radius: 6px;
            background-color: #f9f9f9;
            border: 1px solid #eee;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .widget-option:hover {
            background-color: #f0f0f0;
            border-color: #ddd;
        }
        
        .widget-option-icon {
            background-color: #e0e0e0;
            color: #666;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .system-widget .widget-option-icon {
            background-color: #bbdefb;
            color: #1976d2;
        }
        
        .user-widget .widget-option-icon {
            background-color: #c8e6c9;
            color: #388e3c;
        }
        
        /* è¿æ¥çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .connection-status {
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            background-color: gray;
        }
        
        .status-connected {
            background-color: #4CAF50; /* ç»¿è‰² - å·²è¿æ¥ */
        }
        
        .status-disconnected {
            background-color: #F44336; /* çº¢è‰² - æœªè¿æ¥ */
        }
        
        .status-transmitting {
            background-color: #FFC107; /* é»„è‰² - ä¼ è¾“ä¸­ */
            animation: blink 1.5s infinite;
        }
        
        @keyframes blink {
            0% { opacity: 0.4; }
            50% { opacity: 1; }
            100% { opacity: 0.4; }
        }
        
        /* å½“å‰æ—¶é—´æ ·å¼ */
        .current-time {
            font-size: 18px;
            font-weight: bold;
        }
        
        /* ç”µæ± ç”µé‡æ ·å¼ */
        .battery-status {
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .battery-icon {
            position: relative;
            width: 22px;
            height: 12px;
            border: 1px solid white;
            border-radius: 2px;
            margin-right: 5px;
        }
        
        .battery-icon::after {
            content: '';
            position: absolute;
            top: 2px;
            right: -4px;
            width: 3px;
            height: 8px;
            background-color: white;
            border-radius: 0 2px 2px 0;
        }
        
        .battery-level {
            position: absolute;
            top: 1px;
            left: 1px;
            height: 10px;
            background-color: #4CAF50;
            border-radius: 1px;
        }
        
        .battery-low {
            background-color: #F44336;
        }
        
        .battery-charging {
            background-color: #2196F3;
        }
    </style>
</head>
<body>
    <div class="frame-container">
        <div class="top-frame">
            <button id="exitEditModeBtn">é€€å‡ºç¼–è¾‘</button>
            
            <!-- è¿æ¥çŠ¶æ€ -->
            <div class="connection-status">
                <div class="status-indicator"></div>
                <span class="status-text">æœªè¿æ¥</span>
            </div>
            
            <!-- å½“å‰æ—¶é—´ -->
            <div class="current-time">00:00:00</div>
            
            <!-- ç”µæ± çŠ¶æ€ -->
            <div class="battery-status">
                <div class="battery-icon">
                    <div class="battery-level" style="width: 70%;"></div>
                </div>
                <span class="battery-percentage">70%</span>
            </div>
            
            <!-- åˆ é™¤åŒºåŸŸæ–‡æœ¬ -->
            <div class="delete-zone-text">æ‹–åŠ¨åˆ°è¿™é‡Œåˆ é™¤ç»„ä»¶</div>
        </div>
        <div class="bottom-frame">
            <iframe src="desktop.html" id="bottomFrame"></iframe>
        </div>
    </div>
    
    <!-- ç»Ÿä¸€èœå•é®ç½©å±‚ -->
    <div id="afcMenuOverlay"></div>
    
    <!-- ç»Ÿä¸€ä¾§è¾¹èœå• -->
    <div id="afcMenu">
        <div class="widget-menu-title">
            èœå•
            <button class="widget-menu-close" onclick="hideMenu()">Ã—</button>
        </div>
        <div id="afcMenuList">
            <!-- èœå•å†…å®¹ä¼šåœ¨showCombinedMenuå‡½æ•°ä¸­æ ¹æ®å½“å‰æ¨¡å¼åŠ¨æ€å¡«å…… -->
        </div>
    </div>
    
    <script>
        // åˆå§‹åŒ–å˜é‡
        let startX = 0;
        let startTime = 0;
        const minDistance = 100; // æœ€å°æ»‘åŠ¨è·ç¦»
        const maxTime = 500; // æœ€å¤§æ»‘åŠ¨æ—¶é—´ (æ¯«ç§’)
        let isDesktopEditMode = false; // æ¡Œé¢ç¼–è¾‘æ¨¡å¼çŠ¶æ€
        
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–æ»‘åŠ¨æ‰‹åŠ¿è¯†åˆ«
            initSwipeGesture();
            
            // åˆå§‹åŒ–åˆ é™¤åŒºåŸŸå’Œé€€å‡ºç¼–è¾‘æŒ‰é’®
            initEditModeControls();
            
            // åˆå§‹åŒ–çŠ¶æ€æŒ‡ç¤ºå™¨
            initStatusIndicators();
            
            // æ·»åŠ æµ‹è¯•æŒ‰é’®ï¼ˆä»…ç”¨äºè°ƒè¯•ï¼‰
            const testBtn = document.createElement('button');
            testBtn.textContent = 'æµ‹è¯•èœå•';
            testBtn.style.position = 'fixed';
            testBtn.style.bottom = '10px';
            testBtn.style.right = '10px';
            testBtn.style.zIndex = '9999';
            testBtn.style.padding = '10px';
            testBtn.style.backgroundColor = '#4CAF50';
            testBtn.style.color = 'white';
            testBtn.style.border = 'none';
            testBtn.style.borderRadius = '5px';
            
            testBtn.onclick = function() {
                console.log('æµ‹è¯•æŒ‰é’®ç‚¹å‡»');
                showCombinedMenu();
            };
            
            document.body.appendChild(testBtn);
        });
        
        // åˆå§‹åŒ–ç¼–è¾‘æ¨¡å¼æ§ä»¶
        function initEditModeControls() {
            const topFrame = document.querySelector('.top-frame');
            const exitBtn = document.getElementById('exitEditModeBtn');
            
            // æ·»åŠ é€€å‡ºç¼–è¾‘æ¨¡å¼æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            exitBtn.addEventListener('click', function() {
                const iframe = document.getElementById('bottomFrame');
                if (iframe && iframe.contentWindow && iframe.contentWindow.exitEditMode) {
                    iframe.contentWindow.exitEditMode();
                }
            });
            
            // ä¸ºé¡¶éƒ¨åŒºåŸŸæ·»åŠ æ‹–æ”¾äº‹ä»¶ï¼ˆç”¨ä½œåˆ é™¤åŒºåŸŸï¼‰
            topFrame.addEventListener('dragover', function(e) {
                if (isDesktopEditMode) {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'move';
                    this.classList.add('drag-over');
                }
            });
            
            topFrame.addEventListener('dragleave', function(e) {
                this.classList.remove('drag-over');
            });
            
            topFrame.addEventListener('drop', function(e) {
                if (!isDesktopEditMode) return;
                
                e.preventDefault();
                this.classList.remove('drag-over');
                
                // è·å–ç»„ä»¶IDå¹¶è½¬å‘ç»™iframe
                const widgetId = e.dataTransfer.getData('text/plain');
                if (widgetId) {
                    // é€šçŸ¥iframeå¤„ç†åˆ é™¤
                    const iframe = document.getElementById('bottomFrame');
                    if (iframe && iframe.contentWindow) {
                        // ç§»é™¤å¯¹åº”ç»„ä»¶
                        const widgetElement = iframe.contentDocument.getElementById(widgetId);
                        if (widgetElement) {
                            widgetElement.remove();
                            
                            // é€šçŸ¥iframeæ›´æ–°ç®¡ç†å™¨
                            if (iframe.contentWindow.widgetManager) {
                                iframe.contentWindow.widgetManager.removeWidget(widgetId);
                                iframe.contentWindow.widgetManager.saveLayout();
                            }
                        }
                    }
                }
            });
            
            // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            topFrame.addEventListener('touchmove', function(e) {
                if (isDesktopEditMode) {
                    const iframe = document.getElementById('bottomFrame');
                    console.log('é¡¶éƒ¨åŒºåŸŸè§¦æ‘¸ç§»åŠ¨äº‹ä»¶');
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ­£åœ¨æ‹–åŠ¨çš„ç»„ä»¶
                    if (iframe && iframe.contentWindow && iframe.contentWindow.isDragging) {
                        console.log('iframeæŠ¥å‘Šæœ‰ç»„ä»¶æ­£åœ¨æ‹–åŠ¨');
                        this.classList.add('drag-over');
                        
                        // é˜²æ­¢è§¦æ‘¸äº‹ä»¶ç»§ç»­ä¼ æ’­å’Œé»˜è®¤è¡Œä¸º
                        if (e.cancelable) {
                            e.preventDefault();
                        }
                    }
                }
            }, { passive: false });
            
            topFrame.addEventListener('touchend', function(e) {
                console.log('é¡¶éƒ¨åŒºåŸŸè§¦æ‘¸ç»“æŸäº‹ä»¶');
                this.classList.remove('drag-over');
                
                // é˜²æ­¢è§¦æ‘¸äº‹ä»¶ç»§ç»­ä¼ æ’­å’Œé»˜è®¤è¡Œä¸º
                if (e.cancelable) {
                    e.preventDefault();
                }
            }, { passive: false });
        }
        
        // æ£€æŸ¥æ˜¯å¦åº”è¯¥åˆ é™¤ç»„ä»¶ - ç”±iframeè°ƒç”¨
        function checkDeleteWidget(clientX, clientY, widgetId) {
            if (!isDesktopEditMode) return false;
            
            console.log(`æ£€æŸ¥åˆ é™¤ï¼šè§¦æ‘¸ç‚¹åæ ‡(${clientX}, ${clientY}), ç»„ä»¶ID:${widgetId}`);
            
            // æ£€æŸ¥æ˜¯å¦åœ¨é¡¶éƒ¨åˆ é™¤åŒºåŸŸå†…
            const topFrame = document.querySelector('.top-frame');
            const rect = topFrame.getBoundingClientRect();
            console.log(`åˆ é™¤åŒºåŸŸèŒƒå›´: å·¦:${rect.left}, ä¸Š:${rect.top}, å³:${rect.right}, ä¸‹:${rect.bottom}`);
            
            // æ£€æŸ¥è§¦æ‘¸ç‚¹æ˜¯å¦åœ¨åˆ é™¤åŒºåŸŸå†…
            if (clientY >= rect.top && clientY <= rect.bottom &&
                clientX >= rect.left && clientX <= rect.right) {
                console.log(`ç»„ä»¶ ${widgetId} çš„è§¦æ‘¸ç‚¹åœ¨åˆ é™¤åŒºåŸŸå†…ï¼Œåº”è¯¥åˆ é™¤`);
                
                // æ·»åŠ è§†è§‰åé¦ˆ
                topFrame.classList.add('drag-over');
                setTimeout(() => {
                    topFrame.classList.remove('drag-over');
                }, 300);
                
                return true;
            }
            
            console.log(`ç»„ä»¶ ${widgetId} çš„è§¦æ‘¸ç‚¹ä¸åœ¨åˆ é™¤åŒºåŸŸå†…`);
            topFrame.classList.remove('drag-over');
            return false;
        }
        
        // æ¡Œé¢ç¼–è¾‘æ¨¡å¼çŠ¶æ€å˜åŒ–å¤„ç†
        function onDesktopEditModeChange(editMode) {
            console.log(`æ¡Œé¢ç¼–è¾‘æ¨¡å¼å˜åŒ–: ${editMode}`);
            isDesktopEditMode = editMode;
            
            // æ›´æ–°é¡¶éƒ¨æ¡†æ¶çŠ¶æ€
            const topFrame = document.querySelector('.top-frame');
            const exitBtn = document.getElementById('exitEditModeBtn');
            
            if (editMode) {
                // æ¿€æ´»åˆ é™¤åŒºåŸŸ
                topFrame.classList.add('delete-active');
                // æ˜¾ç¤ºé€€å‡ºæŒ‰é’®
                exitBtn.style.display = 'block';
            } else {
                // å…³é—­åˆ é™¤åŒºåŸŸ
                topFrame.classList.remove('delete-active');
                topFrame.classList.remove('drag-over');
                // éšè—é€€å‡ºæŒ‰é’®
                exitBtn.style.display = 'none';
            }
        }
        
        // æš´éœ²å‡½æ•°ç»™iframeè°ƒç”¨
        window.checkDeleteWidget = checkDeleteWidget;
        window.onDesktopEditModeChange = onDesktopEditModeChange;
        
        // åˆå§‹åŒ–æ»‘åŠ¨æ‰‹åŠ¿è¯†åˆ«
        function initSwipeGesture() {
            // æ»‘åŠ¨å¼€å§‹æ—¶è®°å½•ä½ç½®å’Œæ—¶é—´
            function handleTouchStart(e) {
                console.log('è§¦æ‘¸å¼€å§‹');
                // æ£€æŸ¥æ˜¯å¦æœ‰èœå•å·²ç»æ‰“å¼€
                const menu = document.getElementById('afcMenu');
                
                if ((menu && menu.style.right === '0px')) {
                    console.log('èœå•å·²æ‰“å¼€ï¼Œä¸å“åº”æ»‘åŠ¨æ‰‹åŠ¿');
                    return;
                }
                
                startX = e.touches[0].clientX;
                startTime = Date.now();
                console.log(`è®°å½•èµ·å§‹ä½ç½®: X=${startX}, æ—¶é—´=${startTime}`);
            }
            
            // æ»‘åŠ¨ç»“æŸæ—¶æ£€æŸ¥æ˜¯å¦ç¬¦åˆå·¦æ»‘æ¡ä»¶
            function handleTouchEnd(e) {
                console.log('è§¦æ‘¸ç»“æŸ');
                // æ£€æŸ¥æ˜¯å¦æœ‰èœå•å·²ç»æ‰“å¼€
                const menu = document.getElementById('afcMenu');
                
                if ((menu && menu.style.right === '0px')) {
                    console.log('èœå•å·²æ‰“å¼€ï¼Œä¸å“åº”æ»‘åŠ¨æ‰‹åŠ¿');
                    return;
                }
                
                // ç¡®ä¿è¿™æ˜¯ä¸€æ¬¡å•æŒ‡æ»‘åŠ¨
                if (e.changedTouches.length !== 1) {
                    console.log('éå•æŒ‡æ»‘åŠ¨ï¼Œå¿½ç•¥');
                    return;
                }
                
                const endX = e.changedTouches[0].clientX;
                const endTime = Date.now();
                const deltaX = endX - startX;
                const deltaTime = endTime - startTime;
                
                console.log(`æ»‘åŠ¨è·ç¦»: ${deltaX}px, æ—¶é—´: ${deltaTime}ms`);
                console.log(`åˆ¤æ–­æ¡ä»¶: è·ç¦»éœ€å¤§äº${minDistance}px, æ—¶é—´éœ€å°äº${maxTime}ms`);
                
                // å¦‚æœæ˜¯ä»å³å‘å·¦çš„å¿«é€Ÿæ»‘åŠ¨ï¼Œæ˜¾ç¤ºèœå•
                if (deltaX < -minDistance && deltaTime < maxTime) {
                    console.log('æ£€æµ‹åˆ°å·¦æ»‘æ‰‹åŠ¿ï¼Œæ˜¾ç¤ºèœå•');
                    showCombinedMenu();
                }
                
                // å¦‚æœæ˜¯ä»å·¦å‘å³çš„å¿«é€Ÿæ»‘åŠ¨ï¼Œéšè—èœå•
                if (deltaX > minDistance && deltaTime < maxTime) {
                    if (menu && menu.style.right === '0px') {
                        console.log('æ£€æµ‹åˆ°å³æ»‘æ‰‹åŠ¿ï¼Œéšè—èœå•');
                        hideMenu();
                    }
                }
            }
            
            // æ·»åŠ è§¦æ‘¸äº‹ä»¶ç›‘å¬
            document.addEventListener('touchstart', handleTouchStart, { passive: true });
            document.addEventListener('touchend', handleTouchEnd, { passive: true });
            
            console.log('æ»‘åŠ¨æ‰‹åŠ¿è¯†åˆ«å·²åˆå§‹åŒ–');
        }
        
        // æ˜¾ç¤ºåˆå¹¶åçš„èœå•
        function showCombinedMenu() {
            console.log('æ˜¾ç¤ºèœå•');
            
            // ç›´æ¥è·å–å…ƒç´ 
            let menu = document.getElementById('afcMenu');
            let overlay = document.getElementById('afcMenuOverlay');
            let titleDiv = menu.querySelector('.widget-menu-title');
            let menuContent = document.getElementById('afcMenuList');
            
            if (!menu || !overlay) {
                console.error('èœå•å…ƒç´ ä¸å­˜åœ¨');
                return;
            }
            
            console.log('æ‰¾åˆ°èœå•å…ƒç´ ï¼Œå‡†å¤‡æ˜¾ç¤º');
            
            // æ£€æŸ¥æ¡Œé¢iframeæ˜¯å¦å¤„äºç¼–è¾‘æ¨¡å¼
            const iframe = document.getElementById('bottomFrame');
            let editMode = false;
            
            try {
                if (iframe && iframe.contentWindow) {
                    editMode = iframe.contentWindow.isEditMode && iframe.contentWindow.isEditMode();
                }
            } catch (e) {
                console.error('æ— æ³•è·å–iframeç¼–è¾‘æ¨¡å¼çŠ¶æ€', e);
            }
            
            // æ ¹æ®å½“å‰æ¨¡å¼æ˜¾ç¤ºä¸åŒçš„èœå•å†…å®¹
            if (editMode) {
                // ç¼–è¾‘æ¨¡å¼ - æ˜¾ç¤ºç»„ä»¶èœå•
                titleDiv.innerHTML = 'æ·»åŠ ç»„ä»¶<button class="widget-menu-close" onclick="hideMenu()">Ã—</button>';
                menuContent.innerHTML = `
                    <div class="widget-option system-widget" data-widget-id="system.small">
                        <div class="widget-option-icon">1x1</div>
                        <div>å°ç»„ä»¶</div>
                    </div>
                    <div class="widget-option system-widget" data-widget-id="system.medium">
                        <div class="widget-option-icon">3x1</div>
                        <div>ä¸­ç»„ä»¶</div>
                    </div>
                    <div class="widget-option system-widget" data-widget-id="system.large">
                        <div class="widget-option-icon">4x2</div>
                        <div>å¤§ç»„ä»¶</div>
                    </div>
                    <div class="widget-option user-widget" data-widget-id="user.custom">
                        <div class="widget-option-icon">2x2</div>
                        <div>è‡ªå®šä¹‰ç»„ä»¶</div>
                    </div>
                    <div class="widget-option system-widget" data-widget-id="system.model-name">
                        <div class="widget-option-icon">3x1</div>
                        <div>æ¨¡å‹åç§°</div>
                    </div>
                    <div class="widget-option system-widget" data-widget-id="system.model-image">
                        <div class="widget-option-icon">4x3</div>
                        <div>æ¨¡å‹å›¾ç‰‡</div>
                    </div>
                `;
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                const options = menuContent.querySelectorAll('.widget-option');
                options.forEach(option => {
                    option.addEventListener('click', function() {
                        const widgetId = this.dataset.widgetId;
                        // è°ƒç”¨iframeä¸­çš„å‡½æ•°æ·»åŠ ç»„ä»¶
                        if (iframe && iframe.contentWindow && iframe.contentWindow.addWidgetFromParent) {
                            iframe.contentWindow.addWidgetFromParent(widgetId);
                            hideMenu();
                        } else {
                            console.error('æ— æ³•è°ƒç”¨iframeä¸­çš„addWidgetFromParentå‡½æ•°');
                        }
                    });
                });
            } else {
                // æ™®é€šæ¨¡å¼ - æ˜¾ç¤ºAFCèœå•
                titleDiv.innerHTML = 'AFC<button class="widget-menu-close" onclick="hideMenu()">Ã—</button>';
                menuContent.innerHTML = `
                    <div class="menu-option"><div class="menu-icon">ğŸ“¡</div>å¯¹é¢‘</div>
                    <div class="menu-option"><div class="menu-icon">ğŸŒ</div>è¯­è¨€</div>
                    <div class="menu-option"><div class="menu-icon">âš™ï¸</div>ç³»ç»Ÿè®¾ç½®</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ‘¤</div>è´¦å·ä¸åŒæ­¥</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ›’</div>åº”ç”¨å•†åº—</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ¨</div>ä¸»é¢˜è®¾ç½®</div>
                    <div class="menu-option"><div class="menu-icon">â„¹ï¸</div>å…³äºæˆ‘ä»¬</div>
                    <div class="menu-option"><div class="menu-icon">â“</div>å¸®åŠ©ä¸­å¿ƒ</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ”„</div>ç‰ˆæœ¬æ›´æ–°</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ””</div>é€šçŸ¥è®¾ç½®</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ”’</div>éšç§è®¾ç½®</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ’¾</div>æ•°æ®å¤‡ä»½</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ“¶</div>ç½‘ç»œè®¾ç½®</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ’½</div>å­˜å‚¨ç®¡ç†</div>
                    <div class="menu-option"><div class="menu-icon">ğŸ”§</div>å¼€å‘è€…é€‰é¡¹</div>
                `;
            }
            
            // æ˜¾ç¤ºèœå•å’Œé®ç½©
            overlay.style.display = 'block';
            menu.style.right = '0';
            
            // æ·»åŠ é®ç½©ç‚¹å‡»äº‹ä»¶
            overlay.onclick = hideMenu;
            
            console.log('èœå•å·²æ˜¾ç¤º');
        }
        
        // éšè—èœå•
        function hideMenu() {
            console.log('éšè—èœå•');
            
            // ç›´æ¥è·å–å…ƒç´ 
            const menu = document.getElementById('afcMenu');
            const overlay = document.getElementById('afcMenuOverlay');
            
            if (!menu || !overlay) {
                console.error('èœå•å…ƒç´ ä¸å­˜åœ¨');
                return;
            }
            
            menu.style.right = '-300px';
            overlay.style.display = 'none';
            
            console.log('èœå•å·²éšè—');
        }
        
        // åˆå§‹åŒ–çŠ¶æ€æŒ‡ç¤ºå™¨
        function initStatusIndicators() {
            // åˆå§‹åŒ–å½“å‰æ—¶é—´
            updateTime();
            setInterval(updateTime, 1000);
            
            // æ¨¡æ‹Ÿè¿æ¥çŠ¶æ€å˜åŒ–
            updateConnectionStatus('connected');
            
            // æ¨¡æ‹Ÿç”µæ± çŠ¶æ€
            updateBatteryStatus(70, false);
            
            // å°è¯•ä½¿ç”¨Battery API (å¦‚æœæµè§ˆå™¨æ”¯æŒ)
            if (navigator.getBattery) {
                navigator.getBattery().then(function(battery) {
                    updateBatteryFromAPI(battery);
                    
                    // ç›‘å¬ç”µæ± çŠ¶æ€å˜åŒ–
                    battery.addEventListener('levelchange', function() {
                        updateBatteryFromAPI(battery);
                    });
                    battery.addEventListener('chargingchange', function() {
                        updateBatteryFromAPI(battery);
                    });
                });
            }
        }
        
        // æ›´æ–°æ—¶é—´æ˜¾ç¤º
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            document.querySelector('.current-time').textContent = timeStr;
        }
        
        // æ›´æ–°è¿æ¥çŠ¶æ€
        function updateConnectionStatus(status) {
            const indicator = document.querySelector('.status-indicator');
            const statusText = document.querySelector('.status-text');
            
            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
            indicator.classList.remove('status-connected', 'status-disconnected', 'status-transmitting');
            
            // æ ¹æ®çŠ¶æ€è®¾ç½®æ ·å¼å’Œæ–‡æœ¬
            switch(status) {
                case 'connected':
                    indicator.classList.add('status-connected');
                    statusText.textContent = 'å·²è¿æ¥';
                    break;
                case 'disconnected':
                    indicator.classList.add('status-disconnected');
                    statusText.textContent = 'æœªè¿æ¥';
                    break;
                case 'transmitting':
                    indicator.classList.add('status-transmitting');
                    statusText.textContent = 'ä¼ è¾“ä¸­';
                    break;
                default:
                    indicator.classList.add('status-disconnected');
                    statusText.textContent = 'æœªè¿æ¥';
            }
        }
        
        // æ›´æ–°ç”µæ± çŠ¶æ€
        function updateBatteryStatus(level, isCharging) {
            const batteryLevel = document.querySelector('.battery-level');
            const batteryPercentage = document.querySelector('.battery-percentage');
            
            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
            batteryLevel.classList.remove('battery-low', 'battery-charging');
            
            // è®¾ç½®ç”µé‡ç™¾åˆ†æ¯”
            batteryLevel.style.width = `${level}%`;
            batteryPercentage.textContent = `${level}%`;
            
            // æ ¹æ®ç”µé‡å’Œå……ç”µçŠ¶æ€è®¾ç½®æ ·å¼
            if (isCharging) {
                batteryLevel.classList.add('battery-charging');
            } else if (level <= 20) {
                batteryLevel.classList.add('battery-low');
            }
        }
        
        // ä»Battery APIæ›´æ–°ç”µæ± çŠ¶æ€
        function updateBatteryFromAPI(battery) {
            const level = Math.round(battery.level * 100);
            const isCharging = battery.charging;
            updateBatteryStatus(level, isCharging);
        }
    </script>
</body>
</html> 